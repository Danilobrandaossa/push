enum DeviceCategory {
  CHROME
  FIREFOX
  SAFARI
  EDGE
  OPERA
}

enum DevicePlatform {
  ANDROID
  IOS
  WEB
}

enum DeviceStatus {
  PENDING
  ACTIVE
  INACTIVE
  EXPIRED
}

type Device {
  id: ID!
  appId: ID!
  app: App
  token: String!
  category: DeviceCategory
  platform: DevicePlatform!
  status: DeviceStatus!
  userId: String
  metadata: JSON
  # WebPush subscription keys (only for WEB platform)
  webPushP256dh: String
  webPushAuth: String
  # VAPID public key used when device was registered (for debugging VAPID mismatch issues)
  vapidPublicKeyUsed: String
  # Current VAPID public key from app (for debugging VAPID mismatch issues)
  currentVapidPublicKey: String

  # Relations
  deliveryLogs: [DeliveryLog!]

  # Timestamps
  createdAt: Timestamp!
  updatedAt: Timestamp!
  lastSeenAt: Timestamp
}

input RegisterDeviceInput {
  appId: ID!
  token: String!
  category: DeviceCategory
  platform: DevicePlatform!
  userId: String
  metadata: JSON
  # WebPush subscription keys (required for WEB platform)
  webPushP256dh: String
  webPushAuth: String
}

input UpdateDeviceInput {
  status: DeviceStatus
  userId: String
  metadata: JSON
}

extend type Query {
  devices(appId: ID): [Device!]!
  device(id: ID!): Device
  deviceByToken(token: String!): Device
}

extend type Mutation {
  registerDevice(input: RegisterDeviceInput!): Device!
  updateDevice(id: ID!, input: UpdateDeviceInput!): Device!
  deleteDevice(id: ID!): Boolean!
}