enum AutomationType {
  SUBSCRIPTION
  RECURRING
}

enum AutomationFrequency {
  DAILY
  WEEKLY
}

# Template de notificação individual na sequência da automação
type NotificationTemplate {
  title: String!
  body: String!
  data: JSON
  icon: String # URL do ícone da notificação (substitui o ícone padrão do navegador)
  imageUrl: String # URL da imagem grande dentro da notificação
  clickAction: String
  sound: String
  badge: Int
  delayMinutes: Int! # Delay em minutos após o push anterior (0 para o primeiro)
}

type AutomationStats {
  sent: Int!
  delivered: Int!
  failed: Int!
  clicks: Int!
  ctr: Float
  deliveryRate: Float
}

type Automation {
  id: ID!
  appId: ID!
  app: App
  name: String!
  description: String
  type: AutomationType!
  isActive: Boolean!
  
  # Templates das notificações (array de pushes na sequência)
  notificationTemplates: [NotificationTemplate!]!
  
  # Stats agregados
  stats: AutomationStats!
  
  # Para automação RECURRING
  frequency: AutomationFrequency
  timeOfDay: String # Formato HH:MM
  daysOfWeek: JSON # Array de números 0-6 (0 = domingo)
  startDate: Timestamp
  endDate: Timestamp
  nextRunAt: Timestamp
  
  # Relations
  notifications: [Notification!]
  
  # Timestamps
  createdAt: Timestamp!
  updatedAt: Timestamp!
}

input NotificationTemplateInput {
  title: String!
  body: String!
  data: JSON
  icon: String # URL do ícone da notificação (substitui o ícone padrão do navegador)
  imageUrl: String # URL da imagem grande dentro da notificação
  clickAction: String
  sound: String
  badge: Int
  delayMinutes: Int! # Delay em minutos após o push anterior (0 para o primeiro)
}

input CreateAutomationInput {
  appId: ID!
  name: String!
  description: String
  type: AutomationType!
  notificationTemplates: [NotificationTemplateInput!]! # Array de templates (mínimo 1)
  
  # Para RECURRING
  frequency: AutomationFrequency
  timeOfDay: String
  daysOfWeek: JSON
  startDate: Timestamp
  endDate: Timestamp
}

input UpdateAutomationInput {
  name: String
  description: String
  isActive: Boolean
  notificationTemplates: [NotificationTemplateInput!] # Array de templates
  
  # Para RECURRING
  frequency: AutomationFrequency
  timeOfDay: String
  daysOfWeek: JSON
  startDate: Timestamp
  endDate: Timestamp
}

extend type Query {
  automations(appId: ID): [Automation!]!
  automation(id: ID!): Automation
}

extend type Mutation {
  createAutomation(input: CreateAutomationInput!): Automation!
  updateAutomation(id: ID!, input: UpdateAutomationInput!): Automation!
  deleteAutomation(id: ID!): Boolean!
  toggleAutomation(id: ID!): Automation!
}

